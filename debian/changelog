ngcp-db-schema (3.1.1) unstable; urgency=low

  [ Victor Seva ]
  * [3e00250] MT#4837 do not use static id for voip_preference_group

 -- Victor Seva <vseva@sipwise.com>  Tue, 05 Nov 2013 11:36:53 +0100

ngcp-db-schema (3.1.0) unstable; urgency=low

  [ Andreas Granig ]
  * [414909a] Align products and add sip/pbx product.
  * [e33fe8f] Add voip_pbx_groups table.
  * [bd411c4] Add key on voip_pbx_groups.contract_id
  * [33877bc] Make number relation optional.
  * [198b564] Add name to provisioning.voip_pbx_groups
  * [84a3576] Add explicit extension column to voip_pbx_groups.
  * [367f442] Align provisioning.voip_subscribers to pbx feature
  * [9198915] Relate voip_pbx_groups to voip_subscribers.
  * [02f8ef0] Add pbx preferences and update down script.
  * [bef6165] Fix down script and add base cli preference.
  * [a5555d2] Add shared_buddylist_visibility and display_name.
  * [7dd689a] Add PBX autoprovisioning tables.
  * [ac7de8b] Properly reorder autoprov tables.
  * [c6a9b30] Add preference label column.
  * [e4fb1dc] MT#3607 Fix create time for voip_subscribers
  * [ded890d] MT#3977 Add num_lines to autoprov_devices table
  * [6726d8e] MT#3977 Align PBX autoprov tables to ngcp-schema.
  * [48d62c5] MT#3929 Add client cert column to admins.
  * [bf01fbc] MT#3977 Add firmware version column to PBX fw.
  * [02a28fa] MT#4025 Add contract_id column to sound set table.
  * [7fc1e6f] MT#4025 Move contract_id right after reseller_id.
  * [0b4d677] MT#4025 Add contract_sound_set usr preference.
  * [36fbb28] MT#4145 Change contacts.postcode to varchar.
  * [0856d09] MT#3997 Add via_route column to voip_peer_hosts
  * [213cf2c] MT#3997 Remove unique part of lcr_gw key.
  * [35c2e94] MT#4007 Add schema for autoattendant dst config
  * [5c70029] MT#4007 Rename voip_pbx_autoattendants.
  * [b55c8fe] MT#4007 Add destination field to autoattendant.
  * [94f933d] MT#3971 Add max_subscribers column to contracts.
  * [daba8d6] MT#3995 Use flags as id in kamailio.lcr_gw.
  * [92c3904] MT#4571 Set is_superuser for admins in reseller 1
  * [cb3132b] MT#4685 Don't tie firmware to profile.

  [ Andrew Pogrebennyk ]
  * [536afbf] Insert ua_header_{mode,replace} preferences (#3061)
  * [7c98691] Assign ua_header_{mode,replace} preferences to Internal group.
  * [a5fbdbc] Add new up script for outbound_history_info pref (3.0).
  * [97263b0] Assign the outbound_history_info preference to Number Manipulations group.
  * [5be7d3f] add new outbound_* peer preference values for templates commit 634a850
  * [b3f6fa7] Fix default value for inbound_uprn domain pref.

  [ Victor Seva ]
  * [24750af] prosody sipwise_group module needs to select on provisioning.voip_pbx_groups table
  * [a039604] MT#3995 Also fix lcr trigger for peer rules

  [ Michael Prokop ]
  * [4b0977e] Support checking for multiple revisions at once and do batch execution
  * [e16e487] Execute generic revision scripts before applying host specific revisions
  * [f315906] Bump Standards-Version to 3.9.4
  * [22bbf6c] Execute all db-schema scripts in sequential order sorted by ID revision number

  [ Gerhard Jungwirth ]
  * [15907db] MT#4461 create a default-system contact

 -- Andreas Granig <agranig@sipwise.com>  Tue, 29 Oct 2013 12:42:59 +0100

ngcp-db-schema (3.0.8) unstable; urgency=low

  * [63ff917] MT#4571 Set is_superuser for admins in reseller 1

 -- Andreas Granig <agranig@sipwise.com>  Thu, 24 Oct 2013 11:25:45 +0200

ngcp-db-schema (3.0.7) unstable; urgency=low

  [ Andreas Granig ]
  * [e4fb1dc] MT#3607 Fix create time for voip_subscribers

  [ Andrew Pogrebennyk ]
  * [40d23fc] Add 'use domain default' choice to use_rtpproxy and ipv46_for_rtpproxy prefs.

 -- Andrew Pogrebennyk <apogrebennyk@sipwise.com>  Mon, 30 Sep 2013 11:31:13 +0200

ngcp-db-schema (3.0.6) unstable; urgency=low

  * [0588e27] Fix default value for inbound_uprn domain pref.
  * [d90dbc2] Insert ua_header_{mode,replace} preferences (#3061)
  * [ab7bf3e] Assign ua_header_{mode,replace} preferences to Internal group.
  * [ab20e3f] add new outbound_* peer preference values for templates commit 634a850
  * [e32c28d] Add new up script for outbound_history_info pref (3.0).
  * [2c18f04] Assign the outbound_history_info preference to Number Manipulations group.

 -- Andrew Pogrebennyk <apogrebennyk@sipwise.com>  Wed, 25 Sep 2013 17:01:13 +0200

ngcp-db-schema (3.0.5) unstable; urgency=low

  [ Andreas Granig ]
  * [9b4bc89] Use <=> instead of = in triggers for NULL-safe cmp

 -- Andreas Granig <agranig@sipwise.com>  Mon, 26 Aug 2013 16:32:45 +0200

ngcp-db-schema (3.0.4) unstable; urgency=low

  [ Richard Fuchs ]
  * [09fb8da] move 15003 diff files to correct directory
  * [8cbd0aa] add grants on resellers table for cdr exporter

 -- Richard Fuchs <rfuchs@sipwise.com>  Thu, 08 Aug 2013 17:02:51 -0400

ngcp-db-schema (3.0.3) unstable; urgency=low

  * [29e3d80] Grant subscriber/domain privileges to prosody.

 -- Andreas Granig <agranig@sipwise.com>  Thu, 08 Aug 2013 10:57:01 +0200

ngcp-db-schema (3.0.2) unstable; urgency=low

  * [df52183] Add more prosody grants on provisioning tables.

 -- Andreas Granig <agranig@sipwise.com>  Wed, 07 Aug 2013 18:46:46 +0200

ngcp-db-schema (3.0.1) unstable; urgency=low

  [ Andreas Granig ]
  * Add xmpp entries to xml hosts

 -- Andreas Granig <agranig@sipwise.com>  Wed, 07 Aug 2013 15:42:39 +0200

ngcp-db-schema (3.0.0) unstable; urgency=low

  [ Andrew Pogrebennyk ]
  * also cleanup the obsolete (peer|dom|usr)_preferences
  * add sound handles for auto-attendant
  * add dispatcher entry for pbx.
  * add db update script for sound group "mobile_push" and connecting voice prompt
  * add forgotten db up files for cloud_pbx preference
  * add mobile_push_expiry usr/dom preference
  * rephrase option description
  * add missing semicolon
  * fix syntax error "Table 'provisioning.voip_preference_groups' doesn\'t exist"

  [ Andreas Granig ]
  * Fix handling patterns which already start with "^sip:".
  * Add group table for voip preferences.
  * Assign any unknown preferences to Internals.
  * Fix wrong alias usage to make mysql 5.5 happy.
  * Disable fk-checks during truncate.
  * Split multi-delete into two separate statements.
  * Add dummy contact to all contracts not having one.
  * Add captagent fields to voip_intercept table.
  * Add uuid to carrier.subscribers table.
  * Fix wrong avpf/avp value in rtcp_feedback pref.
  * Changed cc_delivery_port to unsigned.
  * Move reseller_id to contact.
  * Make ringtimeout internal and flag preferences.
  * Add missing reseller_id to sounds and rw-rules.
  * Use correct db for scripts.
  * Add prosody DB.
  * Fix grants.
  * Add index to billing fees.
  * Make prosody db creation more graceful.

  [ Richard Fuchs ]
  * db scripts for billing.billing_fees_history.bfhsems_idx - thx Kirill
  * use a pseudo "add index if not exists" statement

  [ Jon Bonilla ]
  * Increase location.contact length to 1024

 -- Andrew Pogrebennyk <apogrebennyk@sipwise.com>  Wed, 07 Aug 2013 12:25:51 +0200

ngcp-db-schema (2.8.3) unstable; urgency=low

  [ apogrebennyk ]
  * 13447.up,13447.down: Cleanup obsolete rtpproxy preferences.

  [ agranig ]
  * 13449.up,13449.down: Migrate existing peering rules to full URI.

 -- Andreas Granig <agranig@sipwise.com>  Wed, 03 Apr 2013 14:20:10 +0200

ngcp-db-schema (2.8.2) unstable; urgency=low

  [ agranig ]
  * 13393.up,13393.down: Add allow_out_foreign_domain preference.

 -- Andreas Granig <agranig@sipwise.com>  Thu, 28 Mar 2013 15:44:57 +0100

ngcp-db-schema (2.8.0) unstable; urgency=low

  [ agranig ]
  * 13127.down,13127.up: Add inbound peering contract id to peer groups.
  * 13127.down,13127.up: Revert r13198 as this was stupid.
  * 13127.down,13127.up: Add inbound billing profile to contract-billing mapping.
  * 13127.down,13127.up: Another fix for inbound billing.
  * 13127.down,13127.up: Add keys for proper access.
  * 13127.down,13127.up,13216.down,13216.up: Add language strings for fee direction and fix key.
  * 13219_not_replicated.down,13219_not_replicated.up: Split fee-related columns into source and destination.
  * 13225.down,13225.up: Correctly populate billing_fee_history table.
  * 13225.down,13225.up: Fix diff scripts.
  * 13226.down,13226.up: Add source column for billing fees.
  * 13226.up: Stupid mysql doesn't allow empty string as pattern.
  * 13288.down,13288.up: Use export fields for marker.
  * 13288.down,13288.up: Alter permissions for exporter user.
  * 13226.down,13226.up: Fix replication issue.
  * 13225.down,13225.up: Explicitely USE billing db.
  * 12649.down,12649.up: Fix typo and improve phrasing.
  * 12765.down,12765.up: Add sound groups.
  * 12693.down,12693.up: Add webfax language strings.
  * 13042_not_replicated.down,13042_not_replicated.up: Add trigger to accounting.cdr.start_time.
  * 13125.down,13125.up: Add schema for account-specific fraud preferences.

  [ apogrebennyk ]
  * 13226.up: change column name billing_zone_history_id to correct billing_zones_history_id
  * 13041.up: add ICE preferences and wrap it all into an enum; make ipv4/ipv6 prefs an enum
  * 13042.up: add db-up script for migration and cleanup of legacy rtpproxy settings
  * 13042.up,13117.up: rename script to avoid naming conflict
  * 13140.up: make outbound_socket a peer-only preference; cleanup preference values

  [ rdieser ]
  * 12676.up: create error message Serever.System.RRDFoldersSearch
  * 12676.down: delete error message Serever.System.RRDFoldersSearch
  * 12714.up: Server.System.RRDSubfoldersSearch error up script
  * 12714.down: Server.System.RRDSubfoldersSearch error down script
  * 12714.down,12714.up: update in order to handle Server.System.RRDFilesSearch error
  * 12676.down,12676.up,12714.down,12714.up: remove Server.System.RRDFoldersSearch, Server.System.RRDSubfoldersSearch and Server.System.RRDFilesSearch

 -- Andrew Pogrebennyk <apogrebennyk@sipwise.com>  Wed, 27 Mar 2013 14:50:01 +0100

ngcp-db-schema (2.7.1) unstable; urgency=low

  * 13194.up/down: fix cascaded deletion of trusted ips on subcriber termination

 -- Andreas Granig <agranig@sipwise.com>  Tue, 19 Mar 2013 11:43:52 +0100

ngcp-db-schema (2.7.0) unstable; urgency=low

  [ rfuchs ]
  * 10950.down,10950.up: add timestamp column to prepaid_costs table
  * 11318_not_replicated.down,11318_not_replicated.up: change sipstats db charset to latin1
  * 11565.down,11565.up: up/down scripts for adding mobile_push_registrations table
  * 11603_not_replicated.down,11603_not_replicated.up: convert voisniff tables to innodb
  * 11722_not_replicated.down,11722_not_replicated.up: repartition sipstats.statistics
  * 11729_not_replicated.down,11729_not_replicated.up: change sipstats partitioning
  * 3972.down,3972.up: fix up/down scripts
  * 3972.down: fix the fix
  * 3975.down,3975.up: fix up/down scripts
  * 0020_create_oss.up and 12 others: fix modify_timestamp to 1970 for voip_preferences in various places - WIP
  * 4063.down,4063.up: change the up script, not the down script
  * 10290.up: fix typo
  * 10203.up,10287.up,7260.up,7500.up,8408.up,9228.up: more fixing of timestamps
  * 4668.up: more fixing of timestamps
  * 4832.up and 21 others: more fixing of timestamps
  * 5737.up: fix typo
  * 9119.up: try this ugly hack to fix the timestamps
  * 5737.up: properly fix the typo this time
  * 5973.up: fix modify timestamp
  * 11722_not_replicated.up: use a different calculation to determine initial partition

  [ mprokop ]
  * 0010_create_bss.up and 12 others: Use '0' instead of now() for timestamps
  * 12162.up: fix broken quoting in italian translation

  [ agranig ]
  * 11379.down,11379.up: Add grants for carrier-db.
  * 11812.down,11812.up: Add source_ip field to cdr table.
  * 11817.down,11817.up: Add ip_header preference.
  * 11818.down,11818.up: Add privileges for sems_prepaid user.
  * 11812.down,11812.up: Add new CDR rows in one go.
  * 11819.down,11819.up: Add calling-card/call-thru tables.
  * 11819.up: Add foreign key constraint for uuid.

  [ jbonilla ]
  * 12117.up: update Spanish translation
  * 12162.up: Add italian translation strings

  [ apogrebennyk ]
  * 11188.down,11188.up: schema changes for Diversion & forwarding CLI configuration
  * 11581.down,11581.up: DB rev script for no_sipping preference
  * 12002.down,12002.up: add voip_sound_handles for calling card
  * 12061.down,12061.up: make allowed_ips_grp preference hidden
  * 12062.down,12062.up: mark [adm_]ncos_id preferences as dom_pref too (mantis:2041)
  * 12062.down,12062.up: make sure to update all 4 ncos preferences (mantis:2047)
  * 12144.down,12144.up: add missed prompt for callingcard

  [ cveigl ]
  * 10951.down,10951.up: add translations for "Client.Voip.NoSuchSubscriber" (mantis:2035)
  * 11039.down,11039.up: fix language string "Client.Syntax.InvalidSipUsernamePattern"
  * 11062.down,11062.up: fix broken triggers (discovered by dtiefnig; see mantis:2123 and mantis:2121)
  * 11245.down,11245.up: add attribute faxnumber to billing.contacts
  * 11350.down,11350.up: add preferences for (man_)allowed_ips to reanable this feature
  * 11350.up: change (man_)allowed_ips preferences to usr-only preferences

 -- Andrew Pogrebennyk <apogrebennyk@sipwise.com>  Fri, 21 Dec 2012 10:27:38 +0100

ngcp-db-schema (2.6.5) unstable; urgency=low

  [jbonilla]
  * Fix provisioning-lcr transport discrepancies
  * Exec postinst if upgrading from 2.6.4

 -- Jon Bonilla <jbonilla@sipwise.com>  Mon, 03 Sep 2012 16:26:56 +0200

ngcp-db-schema (2.6.4) unstable; urgency=low

  [ Michael Prokop ]
  * Provide postinst to automatically update-db-schema on existing 2.6 systems

  [ jbonilla ]
  * Fix lcr_rule unique key creation/edition in db_revs
  * Fix kamailio.lcr_gw.group_id being droped/recreated with default values
  * Set provisioning.callee_pattern default '' to fix rule triggers
  * Sync provisioning and kamailio lcr rules between new and legacy 2.6 systems
  * Restart kamailio-proxy after fixing the db
  * Full sync provisioning and lcr tables. Cudos to agranig.
  * Drop duplicate rules for the same peering group

 -- Jon Bonilla <jbonilla@sipwise.com>  Thu, 30 Aug 2012 12:14:24 +0200

ngcp-db-schema (2.6.3) unstable; urgency=low

  * Make key on expires for pua non-unique. 

 -- Andrew Pogrebennyk <apogrebennyk@sipwise.com>  Mon, 27 Aug 2012 17:53:25 +0200

ngcp-db-schema (2.6.2) unstable; urgency=low

  [ cveigl ]
  * add error codes for invalid filetype 

 -- Jon Bonilla <jbonilla@sipwise.com>  Thu, 23 Aug 2012 18:35:27 +0200

ngcp-db-schema (2.6.1) unstable; urgency=low

  * Install correct version of voip_phost_crepl_trig trigger. 

 -- Andrew Pogrebennyk <apogrebennyk@sipwise.com>  Mon, 20 Aug 2012 16:39:29 +0200

ngcp-db-schema (2.6.0) unstable; urgency=low

  [ rfuchs ]
  * 9625.down,9625.up: rev scripts for new voisniff db schema
  * 9630_not_replicated.down,9630_not_replicated.up: sanitize sipstats.mark table
  * 9665_not_replicated.down,9665_not_replicated.up: rev scripts to partition message_packets table
  * 9702_not_replicated.down,9702_not_replicated.up: changed sipstats partitioning scheme
  * 9703_not_replicated.down,9703_not_replicated.up: also repartition message_packets table. partitioning format hasn't changed, but the names have
  * 9733.down,9733.up: collectd plugin uses nagios user for db access, so grant select to sipstats.*

  [ dtiefnig ]
  * 8408.down,8408.up: replace emerg_ac by emergency_prefix, add emergency_suffix, drop svc_ac
  * 8846.down,8846.up: add index for rate-o-mat on cdr.rating_status column

  [ mprokop ]
  * changelog: Release new version 0.1.3
  * schema: create schmema directory
  * dump.db: ignore: modify dump.db to test upload procedure
  * ngcp-update-db-schema: Make code less ugly
  * 9458.up: Do not drop voip_vscs if it doesn't exist
  * control: wrap and sort items in Debian packaging files
  * ngcp-update-db-schema: Error out if a sript can not be read
  * ngcp-update-db-schema: Fix script order execution for scripts with >4 digits

  [ agranig ]
  * 8378_not_replicated.down,8378_not_replicated.up: Add statistics table.
  * 8466.down,8466.up: Add pattern column for r-uri matching.
  * 8466.up: Align kamailio.lcr_rule.request_uri length to from_uri length.
  * 8467.down,8467.up: Rename caller prefix to caller pattern and add callee pattern.
  * 8466.up: Make r-uri and empty string by default
  * 8878.down,8878.up: Add presence tables.
  * 9106.down,9106.up: Grant select privs for kamailio to new sound tables.
  * 9159.down,9159.up: Add announcement handles for block-in/out/ncos.
  * 9166.down,9166.up: Add sound handles for rest of rejection cases.
  * 9187.down,9187.up: Add codec column for music-on-hold.
  * 9188.down,9188.up: Add music_on_hold handle.
  * 9221.down,9221.up: Add preference and sound handle for rejecting em calls.
  * 9222.down,9222.up: Add emergency_cli preference.
  * r9228.down,r9228.up: Rename attribute to make new behavior more clear.
  * 9204.up: Use latin1 for now to work-around 1000byte key limit
  * 9205.up: Delete old entries from version before adding new ones.
  * 9256.down,9256.up: Add up/down scripts for outbound_socket pref.
  * 9303.down,9303.up: Add preferences for inbound NPN/UPN selection.
  * 9312.down,9312.up: Add preferences for driving outbound caller CLI.
  * 10290.down,10290.up: Add preferences for limiting calls per account.

  [ apogrebennyk ]
  * 8704.down,8704.up: add db rev scripts for session timer preferences
  * 8704.up: sst_refresh_method is not integer, so type=0
  * 8704.down: add missing db specification
  * 8704.down,8704.up: make sst_enable preference an enum
  * 8704.up: update sst preferences to the latest schema
  * 9119.down,9119.up: set "no" as default for sst_enable in dom/peer; add default method too
  * 9150.down,9150.up: add transport protocol select to peers (db rev scripts)
  * 9204.up,9205.up: update kamailio database for version 3.3
  * 9204.up,9205.up: fix engine & encoding for presence tables - WIP
  * 9205.up: more presence table with indexes that don't fix in 1000 bytes (utf8 issue)
  * r9228.down:9286),r9228.up:9286),r9228.down,r9228.up: avoid "r" in the beginning of file names (otherwise 0 is inserted into db)
  * 9675.down,9675.up: add mobile_push_enable preference
  * 9675.up: fix syntax
  * 9723.up: add "Use domain default" option to outbound CLI settings
  * 9723.down,9723.up: add downgrade script for r9723, some corrections
  * 9723.up: fix sql error
  * 9868.up: fix some discrepancies with vanilla kamailio 3.3 schema
  * 9204.down: add missing kamailio 3.3->3.1 downgrade script
  * 9204.down: default value of address.grp in 3.1 was '0' (testing rocks)
  * 9868.up: keep lcr_gw.group_id column for now..
  * increase length of rewrite rule regexp fields
  * somewhat tune up the cli related preferences
  * backward-compatible defaults: NPN is default for outbound_pai, UPN for outbound_from_user.
  * update cli & user_cli preferences description.
  * drop omit_outbound_displayname preference (obsolete since r9312)
  * return column lcr_gw.group_id, update key on lcr_rule to include request_uri
  * 10268.down,10268.up: db rev script for extension_in_npn preference
  * 10272.down,10272.up: add "no_credit" sound handle


  [ cveigl ]
  * 8461.down,8461.up,DB.pm,Voip.pm,subscriber.pm: allow empty sip-uri
  * 8629.down,8629.up: up/down scripts
  * 8889.down,8889.up: enhanced enum type
  * 8889.up: add example enum-preference
  * 8629.up,9069.down,9069.up: oss/bss support for sound sets
  * 9086.down,9086.up: enable default enum-option; propagate changes in voip_preferences_enum.value
  * 9114.down,9114.up: add attribute "description" to sound sets
  * 9154.down,9154.up: add support for loopplay flag of soundfile handle
  * 9249.down,9249.up: fix broken trigger
  * 9458.down,9458.up: drop unused tables voip_vscs and voip_audio_files
  * 10287.down,10287.up: necessary db-updates according to r10287 (see also: mantis:473)
  * 10331.down,10331.up: make provisioning.voip_subscribers.webusername unique (see mantis:1913)
  * 10332.down,10332.up: add a couple of language strings
  * 10287.up: the "+" was optional for cli-preferences. update data therefore with or without it


 -- Jon Bonilla <jbonilla@sipwise.com>  Fri, 10 Aug 2012 15:45:45 +0200

ngcp-db-schema (0.1.3) unstable; urgency=low

  * Drop grant specific code from ngcp-update-db-schema

 -- Michael Prokop <mprokop@sipwise.com>  Thu, 12 Apr 2012 14:57:08 +0200

ngcp-db-schema (0.1.2) unstable; urgency=low

  * Drop unnecessary postinst script
  * Execute GRANT statement as sipwise user

 -- Michael Prokop <mprokop@sipwise.com>  Thu, 12 Apr 2012 00:07:44 +0200

ngcp-db-schema (0.1.1) unstable; urgency=low

  * Connect as user sipwise to ngcp database.

 -- Michael Prokop <mprokop@sipwise.com>  Wed, 11 Apr 2012 18:33:21 +0200

ngcp-db-schema (0.1.0) unstable; urgency=low

  * Initial release.

 -- Michael Prokop <mprokop@sipwise.com>  Tue, 03 Apr 2012 17:02:06 +0200
